<section class="film-exchange">
    <aside class="sidebar" ng-if="!noData">

        <div class="search-header">
            <h3>Search for film:</h3>
            <a href ng-click="clearSearchFilter()">Reset</a>
        </div>
        <form role="form" ng-submit="searchFilms(filter)">

            <div class="form-group">
                <input class="form-control" name="teamName" placeholder="School or Team Name" ng-model="filter.teamName" type="text">
            </div>

            <div class="form-group">
                <data-date data-id="date-played" data-ng-model="filter.datePlayed" data-max-date="todaysDate" format="dd-MMMM-yyyy" placeholder="Date Played"></data-date>
            </div>

            <div class="form-group">
                <select class="form-control" ng-model="filter.competitionLevel" ng-options="level.code as level.nameUsed for level in teamCompetitionLevels">
                    <option value="">Level of Competition</option>
                </select>
            </div>

            <button id="search-film-cta" class="btn-search" ng-disabled="searching" type="submit"><i class="icon icon-search"></i></button>

        </form>
    </aside>
    <div class="list" ng-if="!noData" ng-class="{'coachView': currentUser.is(COACH)}">
        <data-results ng-hide="filteredFilms.length || isDefaultState" query="query"></data-results>
        <div id="film-exchange-header">
            <div class="title-header">
                <h3>{{filmExchangeName}}</h3>
                <button class="btn btn-default" ng-click="openFilmExchangeModal()" ng-if="!currentUser.is(COACH)">Manage Team Access</button>
            </div>
            <div class="table-header" ng-show="filteredFilms.length > 0">
                <table class="table">
                    <thead>
                        <tr>
                            <th class="film-status"></th>
                            <th class="team">Away</th>
                            <th class="team">Home</th>
                            <th class="score">Score</th>
                            <th class="datePlayed">Date Played</th>
                            <th class="dateAdded" ng-if="!currentUser.is(COACH)">Date Added</th>
                            <th class="actions" ng-if="currentUser.is(COACH)"></th>
                        </tr>
                    </thead>
                </table>
            </div>
        </div>
        <div id="film-exchange-data" class="force-scrollbar">
            <div class="film-exchange-data-no text-center" ng-show="!filteredFilms.length">
                There are no games in your film exchange yet.
            </div>
            <div
                class="film-exchange-data-container"
                ng-repeat="film in filteredFilms"
                ng-class="{searching: searching, removed: isFilmRemoved(film), 'film-not-processed': film.video.status !== 4}"
                ng-if="filteredFilms.length"
                ng-click="openRawFilmModal(film)">
                <table>
                    <tr>
                        <td class="film-status">
                            <i class="icon icon-clock-o" ng-if="film.video.status === 1 || film.video.status === 2" tooltip="Film Processing" tooltip-placement="right"></i>
                            <i class="icon icon-exclamation-circle" ng-if="film.video.status === 8" tooltip="Error While Processing" tooltip-placement="right"></i>
                        </td>
                        <td class="team">
                            <span class="team-name">{{film.awayTeam.name}}<span class="team-won" ng-if="!film.homeTeam.won"> (W)</span></span>
                            <span class="competitionLevel subText">{{film.awayTeam.primaryConference.competitionLevel}}</span>
                        </td>
                        <td class="team">
                            <span class="team-name">{{film.homeTeam.name}}<span class="team-won" ng-if="film.homeTeam.won"> (W)</span></span>
                            <span class="competitionLevel subText">{{film.homeTeam.primaryConference.competitionLevel}}</span>
                        </td>
                        <td class="score">
                            <span>
                                <span>{{film.awayTeam.score}}</span>
                                 -
                                 <span>{{film.homeTeam.score}}</span>
                             </span>
                        </td>
                        <td class="datePlayed">
                            <span>{{film.datePlayed|date:'MMM dd, yyyy'}}</span>
                            <span class="addedBy subText" ng-if="currentUser.is(COACH)">added by {{film.addedByUser.firstName}} {{film.addedByUser.lastName}}</span>
                        </td>
                        <td class="dateAdded" ng-if="!currentUser.is(COACH)">
                            <span>{{film.createdAt|date:'MMM dd, yyyy'}}</span>
                            <span class="addedBy subText" ng-if="!currentUser.is(COACH)">added by <a href="mailto:{{film.addedByUser.email}}?subject={{film.awayTeam.name}} @ {{film.homeTeam.name}} ({{film.datePlayed|date:'MMM dd, yyyy'}})" target="_blank">{{film.addedByUser.firstName}} {{film.addedByUser.lastName}}</a></span>
                        </td>
                        <td class="actions" ng-if="currentUser.is(COACH)">
                            <span class="copy-actions" ng-if="currentUser.getCurrentRole().teamId != film.addedByTeam.id">
                                <a
                                    href
                                    ng-if="!film.isCopying && !film.copiedGame && !film.copyConfirm"
                                    ng-click="onCopyClick($event, film)">
                                    <i class="icon icon-copy"></i> Copy
                                </a>
                                <krossover-spinner
                                    ng-if="film.isCopying && !film.copiedGame && !film.copyConfirm"
                                    size="'15px'">
                                </krossover-spinner>
                                <span ng-if="film.copyConfirm" class="copy-confirm">
                                    <i class="icon icon-ok"></i> Copied
                                </span>
                                <span ng-if="!film.isCopying && film.copiedGame && !film.copyConfirm">
                                    <i class="icon icon-copy"></i> Copied
                                </span>
                            </span>
                            <a
                                href
                                ng-if="currentUser.getCurrentRole().teamId === film.addedByTeam.id"
                                ng-click="onRemoveClick($event, film)">
                                <i class="icon icon-trash-o"></i> Remove
                            </a>
                        </td>
                    </tr>
                </table>
            </div>
        </div>
        <div class="text-center footer" ng-show="allFilms.length > itemPerPage">
            <pagination total-items="allFilms.length" ng-model="page.currentPage" boundary-links="true" class="pagination-sm" previous-text="&lsaquo;" items-per-page="itemPerPage" next-text="&rsaquo;" first-text="&laquo;" last-text="&raquo;" max-size="5" ng-change="pageChanged()"></pagination>
        </div>
    </div>
    <div ng-if="noData" class="noData text-center">
        You currently have no active Film Exchanges to administer.
    </div>

</section>
