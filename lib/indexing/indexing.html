<section class="indexing" data-ng-controller="indexing.Controller as indexing">

    <main class="content-full">

        <div class="alert-editing" data-ng-show="indexing.state === 'INDEXING' && indexing.currentEvent.id"><button class="btn-delete-event" data-ng-click="indexing.deleteCurrentEvent()"><i class="icon-remove"></i> Delete Event</button><h5>Click the variable you wish to edit.</h5></div>

        <x-krossover-videoplayer></x-krossover-videoplayer>

        <div class="indexing-block">

            <form name="formIndexing" role="form" novalidate>

                <span data-ng-if="indexing.state === 'INDEXING'">

                    <!-- Tags -->
                    <div class="tags" data-ng-show="indexing.currentTags.length">

                        <button class="tag" data-ng-repeat="tag in indexing.currentTags" data-keybinding="{{ tag.shortcutKey.toLowerCase() }}" data-ng-click="indexing.selectTag(tag.id)" tabindex="{{ $index+1 }}">{{ tag.name }} ({{ tag.shortcutKey.toLowerCase() }})</button>

                    </div>

                    <!-- Script -->
                    <div class="script" data-ng-hide="indexing.currentTags.length">

                        <span class="item" data-ng-repeat="item in buildScript(indexing.currentEvent)">

                            <!-- String item -->
                            <h3 data-ng-if="isString(item)">{{ item }}&nbsp;</h3>

                            <!-- Dropdown variable -->
                            <a class="dropdown" data-ng-if="item.type === 'DROPDOWN' && indexing.currentEvent.variableValues[item.index]" data-ng-click="indexing.currentEvent.variableValues[item.index] = null">{{ indexing.currentEvent.variableValues[item.index] }}</a>
                            <select class="dropdown" data-ng-if="item.type === 'DROPDOWN' && !indexing.currentEvent.variableValues[item.index]" data-ng-model="indexing.currentEvent.variableValues[item.index]" data-ng-required="item.isRequired" data-ng-options="option as option for option in item.options" onchange="this.blur();" tabindex="{{ item.index }}" autofocus="{{ item.index === 1 }}"></select>

                            <!-- Player dropdown variable -->
                            <a class="player-dropdown" data-ng-if="item.type === 'PLAYER_DROPDOWN' && indexing.currentEvent.variableValues[item.index]" data-ng-click="indexing.currentEvent.variableValues[item.index] = null">{{ indexing.players[indexing.currentEvent.variableValues[item.index]].firstName }} {{ indexing.players[indexing.currentEvent.variableValues[item.index]].lastName }}</a>
                            <select class="player-dropdown" data-ng-if="item.type === 'PLAYER_DROPDOWN' && !indexing.currentEvent.variableValues[item.index]" data-ng-model="indexing.currentEvent.variableValues[item.index]" data-ng-required="item.isRequired" data-ng-options="player.id as player.firstName + ' ' + player.lastName for (key, player) in indexing.players" onchange="this.blur();" tabindex="{{ item.index }}" autofocus="{{ item.index === 1 }}" required></select>

                        </span>

                    </div>

                </span>

                <div class="controls">

                    <!-- Start button -->
                    <button class="btn-indexing-start" data-ng-if="indexing.state === 'READY'" data-keybinding="enter" data-ng-click="indexing.start()"><i class="icon-warning-sign"></i> Press <b>return</b> to start indexing</button>

                    <!-- Index button -->
                    <button class="btn-indexing-index" data-ng-if="indexing.state === 'PLAYING'" data-ng-click="indexing.index()"><i class="icon-info-sign"></i> Press <b>space</b> to index</button>

                    <!-- State movement buttons -->
                    <button class="btn-back" data-ng-if="indexing.state === 'INDEXING'" data-keybinding="esc" data-ng-click="indexing.back()">Back (Esc)</button>
                    <button class="btn-save" data-ng-if="indexing.state === 'INDEXING' && !indexing.currentTags.length && indexing.savable()" data-keybinding="enter" data-ng-click="indexing.save()" data-ng-disabled="formIndexing.$invalid">Save Event (Return)</button>
                    <button class="btn-next" data-ng-if="indexing.state === 'INDEXING' && !indexing.currentTags.length && !indexing.savable()" data-keybinding="enter" data-ng-click="indexing.next()" data-ng-disabled="formIndexing.$invalid">Next (Return)</button>

                    <!-- Save status buttons -->
                    <button class="btn-indexing-saving" data-ng-if="indexing.state === 'SAVING'"><i class="icon-spinner icon-spin icon-large"></i> Saving...</button>
                    <button class="btn-indexing-saved" data-ng-if="indexing.state === 'SAVED'" data-keybinding="enter" data-ng-click="indexing.start()"><i class="icon-ok"></i> Event Saved <div class="btn btn-default">Continue (Return)</div></button>
                    <button class="btn-indexing-save-error" data-ng-if="indexing.state === 'SAVE_ERROR'" data-ng-click="indexing.save()"><i class="icon-remove"></i> Event Not Saved</button>

                    <!-- Delete button -->
                    <button class="btn-indexing-event-deleted" data-ng-if="indexing.state === 'EVENT_DELETED'" data-ng-click="indexing.start()"><i class="icon-remove"></i> Event Deleted</button>

                </div>

            </form>

        </div>

    </main>

    <aside class="sidebar-notes" data-ui-toggle="sidebar.notes">

        <header>

            <h6>Notes</h6>
            <button class="btn-close" data-ng-click="sidebar.playlist = false"><i class="icon-remove"></i></button>

        </header>

        <div class="notes">

        </div>

    </aside>

    <aside class="sidebar-playlist" data-ui-toggle="sidebar.playlist">

        <header>

            <h6>Playlist</h6>
            <button class="btn-close" data-ng-click="sidebar.playlist = false"><i class="icon-remove"></i></button>

        </header>

        <div class="plays">

            <!-- Play -->
            <div class="play" data-ng-repeat="play in indexing.plays">

                <!-- TODO: Period advancement -->
                <!-- <h4 class="period">{{ 'Q1' }}</h4><time> — --><time>{{ play.startTime }} — {{ play.endTime }}</time>

                <!-- TODO: Team with possession -->
                <!--<h3>{{ indexing.teams[HOME].name }}</h3>-->

                <ul class="events">

                    <!-- Event -->
                    <li class="event" data-ng-repeat="event in play.events">

                        <button class="btn-select-event" data-ng-class="{ active: indexing.currentEvent.id === event.id }" data-ng-click="indexing.selectEvent(play, event)" data-ng-disabled="!indexing.state">

                            <span class="item" data-ng-repeat="item in buildScript(event)">

                                <!-- String item -->
                                <p data-ng-if="isString(item)">{{ item }}&nbsp;</p>

                                <!-- Dropdown variable -->
                                <a class="dropdown" data-ng-if="item.type === 'DROPDOWN'" disabled>{{ event.variableValues[item.index] }}</a>

                                <!-- Player dropdown variable -->
                                <a class="player-dropdown" data-ng-if="item.type === 'PLAYER_DROPDOWN'" disabled>{{ indexing.players[event.variableValues[item.index]].firstName }} {{ indexing.players[event.variableValues[item.index]].lastName }}</a>

                            </span>

                        </button>

                    </li>

                </ul>

                <hr>

                <button class="btn-delete-play" data-ng-click="indexing.deletePlay(play)"><i class="icon-remove"></i> Delete Play</button>

            </div>

        </div>

    </aside>

</section>
